var k=Object.defineProperty;var g=(e,s,r)=>s in e?k(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r;var d=(e,s,r)=>(g(e,typeof s!="symbol"?s+"":s,r),r);import"./Grid.1cf73ea1.js";import{i as $}from"./Guards.9dd5c4a2.js";import{f as z}from"./Rect.68a6fabc.js";import{c as l}from"./util.7f611b44.js";import{S}from"./Events.084fe32f.js";const j=(e,s="?")=>{if(e===void 0)throw new Error(`Param '${s}' is undefined. Expected array.`);if(e===null)throw new Error(`Param '${s}' is null. Expected array.`);if(!Array.isArray(e))throw new Error(`Param '${s}' not an array as expected`)},m=e=>(j(e,"array"),e[Math.floor(Math.random()*e.length)]),C=(e=void 0)=>new M(e);class M extends S{constructor(s=void 0){super();d(this,"store",new Map);d(this,"keyString");s===void 0&&(s=r=>typeof r=="string"?r:JSON.stringify(r)),this.keyString=s}add(...s){s.forEach(r=>{const n=this.has(r);this.store.set(this.keyString(r),r),super.fireEvent("add",{value:r,updated:n})})}values(){return this.store.values()}clear(){this.store.clear(),super.fireEvent("clear",!0)}delete(s){const r=this.store.delete(this.keyString(s));return r&&super.fireEvent("delete",s),r}has(s){return this.store.has(this.keyString(s))}toArray(){return Array.from(this.store.values())}}const x=(e,s)=>{if(e.length!==s.length)throw new Error("Keys and values arrays should be same length");return Object.fromEntries(e.map((r,n)=>[r,s[n]]))},O=e=>e===void 0?!1:"x"in e&&"y"in e,A=e=>!(e===void 0||e[1]===void 0),J=(e,s)=>{if("rows"in e&&"cols"in e)if("rows"in s&&"cols"in s){if(e.rows!==s.rows||e.cols!==s.cols)return!1}else return!1;if("size"in e)if("size"in s){if(e.size!==s.size)return!1}else return!1;return!0},P=e=>`Cell{${e.x},${e.y}}`,I=(e,s)=>s===void 0||e===void 0?!1:e.x===s.x&&e.y===s.y,y=(e,s="Param",r)=>{if(e===void 0)throw new Error(s+" is undefined. Expecting {x,y}");if(e.x===void 0)throw new Error(s+".x is undefined");if(e.y===void 0)throw new Error(s+".y is undefined");if(!Number.isInteger(e.x))throw new Error(s+".x is non-integer");if(!Number.isInteger(e.y))throw new Error(s+".y is non-integer");if(r!==void 0&&!D(r,e))throw new Error(`${s} is outside of grid. Cell: ${e.x},${e.y} Grid: ${r.cols}, ${r.rows}`)},h=(e,s="Param")=>{if(e===void 0)throw new Error(`${s} is undefined. Expecting grid.`);if(!("rows"in e))throw new Error(`${s}.rows is undefined`);if(!("cols"in e))throw new Error(`${s}.cols is undefined`);if(!Number.isInteger(e.rows))throw new Error(`${s}.rows is not an integer`);if(!Number.isInteger(e.cols))throw new Error(`${s}.cols is not an integer`)},D=(e,s)=>!(s.x<0||s.y<0||s.x>=e.cols||s.y>=e.rows),T=(e,s)=>{y(e);const r=s.size,n=e.x*r,t=e.y*r;return z({x:n,y:t},r,r)},Z=(e,s)=>{const r=s.size;if(e.x<0||e.y<0)return;const n=Math.floor(e.x/r),t=Math.floor(e.y/r);if(!(n>=s.cols)&&!(t>=s.rows))return{x:n,y:t}},b=Object.freeze(["n","ne","nw","e","s","se","sw","w"]),G=Object.freeze(["n","e","s","w"]),R=(e,s,r="undefined",n)=>{const t=n??b,o=t.map(i=>E(e,s,v(i),r));return x(t,o)},H=(e,s,r,n="stop")=>{if($(r,"steps",!0),r<1)throw new Error("steps should be above zero");const t=b,o=t.map(u=>v(u,r)),i=t.map((u,f)=>E(e,s,o[f],n));return x(t,i)},v=(e,s=1)=>{let r;switch(e){case"n":r={x:0,y:-1*s};break;case"ne":r={x:1*s,y:-1*s};break;case"e":r={x:1*s,y:0};break;case"se":r={x:1*s,y:1*s};break;case"s":r={x:0,y:1*s};break;case"sw":r={x:-1*s,y:1*s};break;case"w":r={x:-1*s,y:0};break;case"nw":r={x:-1*s,y:-1*s};break;default:r={x:0,y:0}}return Object.freeze(r)},E=function(e,s,r,n="undefined"){y(s,"start",e),y(r),h(e,"grid");let t=s.x,o=s.y;switch(n){case"wrap":t+=r.x%e.cols,o+=r.y%e.rows,t<0?t=e.cols+t:t>=e.cols&&(t-=e.cols),o<0?o=e.rows+o:o>=e.rows&&(o-=e.rows);break;case"stop":t+=r.x,o+=r.y,t=l(t,e.cols),o=l(o,e.rows);break;case"undefined":if(t+=r.x,o+=r.y,t<0||o<0||t>=e.cols||o>=e.rows)return;break;case"unbounded":t+=r.x,o+=r.y;break;default:throw new Error(`Unknown BoundsLogic case ${n}`)}return Object.freeze({x:t,y:o})},B=(e,s,r,n)=>{const t=R(e,s,n,r);return Object.entries(t).filter(A)},a=function*(e,s,r,n={}){h(s,"grid"),y(r,"start",s);const t=n.visited??C(c=>P(c)),o=e.options?e.options:(c,w)=>B(c,w,G,"undefined");if(!O(r))throw new Error("'start' parameter is undefined or not a cell");let i=[r],u=[],f=null;for(;i.length>0;){if(f===null){const c=i.pop();if(c===void 0)break;f=c}if(!t.has(f)){t.add(f),yield f;const c=o(s,f).filter(w=>!t.has(w[1]));c.length===0?f!==null&&(i=i.filter(w=>I(w,f))):u.push(...c)}if(u=u.filter(c=>!t.has(c[1])),u.length===0)f=null;else{const c=e.select(u);c!==void 0&&(i.push(c[1]),f=c[1])}}},N=(e,s,r={})=>a({select:n=>n[n.length-1]},e,s,r),W=(e,s,r={})=>a({select:n=>n[0]},e,s,r),p=e=>m(e),X=(e,s,r={})=>a({select:p},e,s,r),Y=(e,s,r={})=>a({options:(n,t)=>{const o=[];for(const i of K(n,t))o.push(["n",i]);return o},select:p},e,s,r),_=(e,s,r={})=>{const{reversed:n=!1}=r;return a({select:u=>u.find(f=>f[0]===(n?"w":"e")),options:(u,f)=>(n?f.x>0?f={x:f.x-1,y:f.y}:f.y>0?f={x:u.cols-1,y:f.y-1}:f={x:u.cols-1,y:u.rows-1}:f.x<u.rows-1?f={x:f.x+1,y:f.y}:f.y<u.rows-1?f={x:0,y:f.y+1}:f={x:0,y:0},[[n?"w":"e",f]])},e,s,r)},ee=(e,s,r={})=>{const{reversed:n=!1}=r;return a({select:o=>o.find(i=>i[0]===(n?"n":"s")),options:(o,i)=>(n?i.y>0?i={x:i.x,y:i.y-1}:i.x===0?i={x:o.cols-1,y:o.rows-1}:i={x:i.x-1,y:o.rows-1}:i.y<o.rows-1?i={x:i.x,y:i.y+1}:i.x<o.cols-1?i={x:i.x+1,y:0}:i={x:0,y:0},[[n?"n":"s",i]])},e,s,r)},K=function*(e,s={x:0,y:0}){h(e,"grid"),y(s,"start",e);let{x:r,y:n}=s,t=!0;do yield{x:r,y:n},r++,r===e.cols&&(n++,r=0),n===e.rows&&(n=0,r=0),r===s.x&&n===s.y&&(t=!1);while(t)};export{Z as a,m as b,K as c,P as d,X as e,ee as f,_ as g,W as h,J as i,N as j,I as k,H as o,T as r,Y as v};
